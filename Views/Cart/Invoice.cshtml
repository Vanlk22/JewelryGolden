@model JewelryGolden.Models.Order
@{
    ViewBag.Title = "Hóa đơn đơn hàng #" + Model.ID;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <div class="row align-items-center">
                        <div class="col">
                            <h4 class="mb-0">
                                <i class="fas fa-file-invoice"></i> Hóa đơn đơn hàng #@Model.ID
                            </h4>
                        </div>
                        <div class="col-auto">
                            <button onclick="window.print()" class="btn btn-light btn-sm">
                                <i class="fas fa-print"></i> In hóa đơn
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Header thông tin cửa hàng -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5 class="text-primary">Jewelry Store</h5>
                            <p class="mb-1"><strong>Địa chỉ:</strong> 141 Street, Binh Thanh , Viet Nam</p>
                            <p class="mb-1"><strong>Điện thoại:</strong> +012 345 67890</p>
                            <p class="mb-0"><strong>Email:</strong> info@jewelrygolden.com</p>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <h6 class="text-muted">Thông tin đơn hàng</h6>
                            <p class="mb-1"><strong>Mã đơn hàng:</strong> #@Model.ID</p>
                            <p class="mb-1"><strong>Ngày đặt:</strong> @Model.CreatedDate</p>
                            <p class="mb-0"><strong>Trạng thái:</strong> 
                                @if (Model.Status)
                                {
                                    <span class="badge bg-success">Đang xử lý</span>
                                }
                                else
                                {
                                    <span class="badge bg-danger">Đã hủy</span>
                                }
                            </p>
                        </div>
                    </div>

                    <hr>

                    <!-- Thông tin khách hàng -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6 class="text-primary">Thông tin khách hàng</h6>
                            <p class="mb-1"><strong>Họ tên:</strong> @Model.CustomerName</p>
                            <p class="mb-1"><strong>Điện thoại:</strong> @Model.CustomerMobile</p>
                            <p class="mb-0"><strong>Email:</strong> @Model.CustomerEmail</p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-primary">Địa chỉ giao hàng</h6>
                            <p class="mb-0">@Model.CustomerAddress</p>
                        </div>
                    </div>

                    <!-- Chi tiết sản phẩm -->
                    <div class="table-responsive mb-4">
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>STT</th>
                                    <th>Sản phẩm</th>
                                    <th class="text-center">Số lượng</th>
                                    <th class="text-end">Đơn giá</th>
                                    <th class="text-end">Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    var orderDetails = Model.OrderDetails?.ToList() ?? new List<JewelryGolden.Models.OrderDetail>();
                                    int stt = 1;
                                    decimal totalAmount = 0;
                                }
                                @foreach (var detail in orderDetails)
                                {
                                    var product = detail.Product;
                                    var itemTotal = (product?.Price ?? 0) * detail.Quantity;
                                    totalAmount += itemTotal;
                                    
                                    <tr>
                                        <td>@stt</td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <img src="@Url.Content("~/Resources/img/" + (product?.Image ?? ""))" 
                                                     alt="@product?.Name" 
                                                     class="invoice-product-image me-3"
                                                     style="width: 50px; height: 50px; object-fit: cover;">
                                                <div>
                                                    <strong>@product?.Name</strong>
                                                    @if (!string.IsNullOrEmpty(product?.Alias))
                                                    {
                                                        <br><small class="text-muted">(@product.Alias)</small>
                                                    }
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-center">@detail.Quantity</td>
                                        <td class="text-end">@((product?.Price ?? 0).ToString("N0")) ₫</td>
                                        <td class="text-end">@itemTotal.ToString("N0") ₫</td>
                                    </tr>
                                    stt++;
                                }
                            </tbody>
                            <tfoot class="table-light">
                                <tr>
                                    <td colspan="4" class="text-end"><strong>Tạm tính:</strong></td>
                                    <td class="text-end"><strong>@totalAmount.ToString("N0") ₫</strong></td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end">Phí vận chuyển:</td>
                                    <td class="text-end text-success">Miễn phí</td>
                                </tr>
                                <tr class="table-primary">
                                    <td colspan="4" class="text-end"><strong>Tổng cộng:</strong></td>
                                    <td class="text-end"><strong class="fs-5">@totalAmount.ToString("N0") ₫</strong></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <!-- Thông tin thanh toán -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6 class="text-primary">Phương thức thanh toán</h6>
                            <p class="mb-0">
                                @switch(Model.PaymentMethod)
                                {
                                    case "cod":
                                        <span class="badge bg-warning fs-6">Thanh toán khi nhận hàng (COD)</span>
                                        break;
                                    case "bank_transfer":
                                        <span class="badge bg-info fs-6">Chuyển khoản ngân hàng</span>
                                        break;
                                    case "credit_card":
                                        <span class="badge bg-primary fs-6">Thẻ tín dụng</span>
                                        break;
                                    default:
                                        <span class="badge bg-secondary fs-6">@Model.PaymentMethod</span>
                                        break;
                                }
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-primary">Trạng thái thanh toán</h6>
                            <p class="mb-0">
                                @if (Model.PaymentStatus)
                                {
                                    <span class="badge bg-success fs-6">Đã thanh toán</span>
                                }
                                else
                                {
                                    <span class="badge bg-warning fs-6">Chưa thanh toán</span>
                                }
                            </p>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.CustomerMessage))
                    {
                        <div class="mb-4">
                            <h6 class="text-primary">Ghi chú từ khách hàng</h6>
                            <p class="bg-light p-3 rounded">@Model.CustomerMessage</p>
                        </div>
                    }

                    <hr>

                    <!-- Footer -->
                    <div class="text-center text-muted">
                        <p class="mb-1">Cảm ơn bạn đã mua sắm tại cửa hàng của chúng tôi!</p>
                        <p class="mb-0">Hóa đơn được tạo tự động vào @DateTime.Now.ToString("dd/MM/yyyy HH:mm")</p>
                    </div>
                </div>
            </div>

            <div class="text-center mt-3">
                <a href="@Url.Action("Index", "Products")" class="btn btn-primary">
                    <i class="fas fa-shopping-bag"></i> Tiếp tục mua sắm
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    .invoice-product-image {
        border: 1px solid #dee2e6;
        border-radius: 4px;
    }
    
    .card {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    @@media print {
        .btn, .card-header .col-auto {
            display: none !important;
        }
        
        .card {
            box-shadow: none !important;
            border: 1px solid #000 !important;
        }
        
        body {
            font-size: 12px !important;
        }
        
        .container {
            max-width: none !important;
        }
    }
</style>
